use std::{collections::HashSet, ops::RangeBounds, time::Instant};

use itertools::Itertools;

const INPUT: &str = "
.......S.......
...............
.......^.......
...............
......^.^......
...............
.....^.^.^.....
...............
....^.^...^....
...............
...^.^...^.^...
...............
..^...^.....^..
...............
.^.^.^.^.^...^.
...............
";

const INPUT2: &str = "
......................................................................S......................................................................
.............................................................................................................................................
......................................................................^......................................................................
.............................................................................................................................................
.....................................................................^.^.....................................................................
.............................................................................................................................................
....................................................................^...^....................................................................
.............................................................................................................................................
...................................................................^.^...^...................................................................
.............................................................................................................................................
..................................................................^.......^..................................................................
.............................................................................................................................................
.................................................................^...^.^.^.^.................................................................
.............................................................................................................................................
................................................................^.....^.^...^................................................................
.............................................................................................................................................
...............................................................^.^.^.^...^.^.^...............................................................
.............................................................................................................................................
..............................................................^.^.^.^.^...^...^..............................................................
.............................................................................................................................................
.............................................................^.^...^.^.^.^...^.^.............................................................
.............................................................................................................................................
............................................................^...^.^.^.......^...^............................................................
.............................................................................................................................................
...........................................................^.^.....^...^.....^.^.^...........................................................
.............................................................................................................................................
..........................................................^...^.^...^...^...^.^.^.^..........................................................
.............................................................................................................................................
.........................................................^.^.^...^.^.^.^.....^.^.^.^.........................................................
.............................................................................................................................................
........................................................^.^.....^.^.^.^.^...^.^...^.^........................................................
.............................................................................................................................................
.......................................................^.^.......^.^.^.^.....^.......^.......................................................
.............................................................................................................................................
......................................................^.^.^.^.^...^...^.^...^.........^......................................................
.............................................................................................................................................
.....................................................^.....^.^.......^.........^.^.^.^.^.....................................................
.............................................................................................................................................
....................................................^.^.^.^...^.^.^...^.....^...^...^.^.^....................................................
.............................................................................................................................................
...................................................^...^.^.^.....^...^.^.^.^.^.^.^.......^...................................................
.............................................................................................................................................
..................................................^.^...^.^.^.^.^...^.^.....^.^.^.^.^.^.^.^..................................................
.............................................................................................................................................
.................................................^.^.^.^.^.......^.^...^.^.^.....^.^...^...^.................................................
.............................................................................................................................................
................................................^.^.^.^...^...^.^.^.^.^.^.^.^.^.^.^.^...^...^................................................
.............................................................................................................................................
...............................................^.^.^.^...^...^...^.^.^...^.^.^.....^.^.^...^.^...............................................
.............................................................................................................................................
..............................................^...^...^...^.....^...^...^...^...^...^.^.^.^...^..............................................
.............................................................................................................................................
.............................................^.^...^.^.^.^.^...^.^...^.^.....^.^.^.^.^.^.......^.............................................
.............................................................................................................................................
............................................^.^.^.^.^...^.^.....^...^.^.^.^.......^...^...^.^...^............................................
.............................................................................................................................................
...........................................^.^...^.^.^...^.^.^.....^.....^...^.^.^...^...^.^.^.^.^...........................................
.............................................................................................................................................
..........................................^...^...^...^.....^.^.^.^...^.^...^.^.^.^.^.^.^.^.^.^.^.^..........................................
.............................................................................................................................................
.........................................^.^.....^.^...^...^...^.^.^.^...^.^...^.........^.^.^.....^.........................................
.............................................................................................................................................
........................................^.^.....^.^.^...^...^...^.....^...^...^.^.^.^.^.^.^.^.^.^.^.^........................................
.............................................................................................................................................
.......................................^...^.^.^.^.^...^...^.^.^.^.^.^...^...^.^...^.......^.^.^...^.^.......................................
.............................................................................................................................................
......................................^.^.^...^.^.^.....^.......^.................^...^.^.^.^.^.^.^.^.^......................................
.............................................................................................................................................
.....................................^.^.......^.....^.^...^.^.^.^.......^...^.^.^...^.^...^.^.^.^...^.^.....................................
.............................................................................................................................................
....................................^.^...^...^.^.^.^.....^...^...^.^.^.....^...^...^.^.^...^...^...^...^....................................
.............................................................................................................................................
...................................^.^.^...^.....^...^.^.^...^...^.^...^.^.^...^.^.......^.^...^.^...^...^...................................
.............................................................................................................................................
..................................^.^.^.^.......^...^.^.^...^.^.^.^...^.^.^.....^.^.^.......^.^.^...^.^...^..................................
.............................................................................................................................................
.................................^...^...^.^.^.^...^...^...^.^.^.....^.^.^...^.^.......^.^.^.^...^.....^.^.^.................................
.............................................................................................................................................
................................^.^.^.....^.^.^.^.^.^.....^.^.^...^.^...^.....^.^.^.^.^.^.^.^.....^.^.^.^.^.^................................
.............................................................................................................................................
...............................^...^.^.^.....^.^...^...^.......^.^.^.....^.^.^.^.^.^.^.^.^...^...^.^.....^.^.^...............................
.............................................................................................................................................
..............................^.^.^.^.^.......^.^...^...^.^.^...^...^.^.^.........^.^.^.^...^.....^...^.^.^.^.^..............................
.............................................................................................................................................
.............................^...^...^.^...^.^.^.^.........^.^.^.^.^.^...^.^...^.....^.....^.^.....^...^...^.^.^.............................
.............................................................................................................................................
............................^.......^...^.^.^.^.^...^...^.^.^.^.^.^...^.^...^.^.^.^...^.^.^.^.^.^.^...^.^.^...^.^............................
.............................................................................................................................................
...........................^.^...^...^.^...^...^.^.^.....^.......^.^.....^.^.^.^.^.^.......^.^.^...^...^.^...^...^...........................
.............................................................................................................................................
..........................^.......^.^.^.^.^.^...^.^.^...^...^.......^...^.^.^...^.....^...^...^.....^...^.^...^.^.^..........................
.............................................................................................................................................
.........................^...^.^.^.^...^.^...^.^.^.^.^.^...^...^.^.....^.^.^.^...^.^...^.^.^.^.^.^.........^.^.^.^.^.........................
.............................................................................................................................................
........................^...^.^...^...^.^.^.^.^.^.^.^.^.^.^...^...^...^...^.......^.^.....^.^.^.^.^.^.....^...^...^.^........................
.............................................................................................................................................
.......................^...^.^...^...^.^.......^.^.^.^.^.^...^.^.^.^...^.^...^.^.^.......^.....^.^.^.^.^.^.....^.^.^.^.......................
.............................................................................................................................................
......................^.^.^.^.^.^...^...^.^.^.^...^.^.....^.....^.^.^.^...^.^.^.^.^.^...^.^...^.^.^.........^.......^.^......................
.............................................................................................................................................
.....................^.^.^.....^.....^.^.^.^.......^.^.^...^.^.^.....^...^.^.^.^...^...^.^.......^...^.^.^.^...^.^.^...^.....................
.............................................................................................................................................
....................^.....^.^.....^...^...^.^...^.^.^.^.^.^.^.^.^.^.^.^.^.^.^...^.^.^...^...^.^...^...^...^...^.....^...^....................
.............................................................................................................................................
...................^.^...^...^.^.^.^.....^.^.^...^.^.....^...^...^.^.^.^...^.^...^.^.^.^.^.^.....^.^.^.^.......^...^.^.^.^...................
.............................................................................................................................................
..................^.^.......^.^...^.^...^.^.^...^.^.^.^...^.....^.^.^...^.^.^.^.^...^.^...^...^.^.^.^.^.^...^.^.^.^.^.^...^..................
.............................................................................................................................................
.................^.^.^...^.^.^.^.....^.^.^.^.^.....^.^.....^.^.^.^...^...^.^.......^.^.^.^.^...^.^.....^.^...^.^.^.^...^...^.................
.............................................................................................................................................
................^...^.^.^...^.^.....^.^.^.^.^.^.^.^...^.....^.^...^.^...^...^...^...^.^.^.....^.^.^.^.^.^.^.....^...^.^.^...^................
.............................................................................................................................................
...............^...^.^...^.^.^...^.^...^...^.^.^.^.^.^.^.^.^.^.^.^...^.^.^...^.....^.^.......^.^...^.^...^.^.^.^.^.^.^.^.^.^.^...............
.............................................................................................................................................
..............^.^...^...^.....^...^.^...^.^...^.^.^.^.^.....^...^...^.....^.^.^...^.^...^.^...^.....^...^...^.....^...^.^.^...^..............
.............................................................................................................................................
.............^.....^.^.^.^...^.....^.^.......^.^.^.^.^.^.^.....^...^.....^.^.....^.^.^.....^...^.^...^.^.^.^...^.^.....^...^.^.^.............
.............................................................................................................................................
............^.^...^.^.......^.^.^.^.^...^.^.^.....^.^.^.^...^...^.....^...^.^...^.^.^...^.^.^.^...^...^.....^.^.^.^...^.^...^.^.^............
.............................................................................................................................................
...........^.....^.^.^.^...^...^.^...^...^.....^.^...^...^.^.^...^.^.......^.^.^...^.^...^.^.......^.^...^.......^.^...^...^.^.^.^...........
.............................................................................................................................................
..........^.^.^.^.......^...^.^.^.^.^.^.^...^.....^.^...^.^.^.^.^.^.^.^.^...^.^.....^.^.......^.^.^.^...^.^.......^.^...^.^...^...^..........
.............................................................................................................................................
.........^.^...^.....^.^.^.^.^.^.^.^...^.^.^.^...^.^.^.^.^.^.^.^...^...^...^.^.^.^.^.^.^.^.^.^.^...^.....^.^.^.^.^.^...^.^.^...^.^.^.........
.............................................................................................................................................
........^.^.^...^.^...^.^.^.^...^.......^...^...^.^.^.^.....^.^...^.^.^.....^.^.^.^.^.^.^...^.^...^.^.^.......^...^.^...^.....^.^...^........
.............................................................................................................................................
.......^.^.^.....^.....^.....^.^.^.^.^.^...^.^...^...^...^.........^.^...^.^.^...^.^...^.^.^...^.^.........^.^.^.^.^.^...^...^.^.^.^.^.......
.............................................................................................................................................
......^...^.^...^...^.^.^...^...^.^.^.^.^.^.^.^.^.^...^...^.....^.......^.^.^.^.^.^.^.^...^.^.^...^...^.^...^.....^.......^.^.^...^.^.^......
.............................................................................................................................................
.....^.^.^.....^...^.^.............^...^.^.^.^.^.^...^...^.^.^.^.^.^.^...^...............^.......^.^.^.....^.^...^.^.^.^.......^...^.^.^.....
.............................................................................................................................................
....^...^.^.^...^...^...^.^.......^...^.^.^.^.^.^.^...^.^.^.^.^.....^.^...^.^...^.^.^.^.........^.....^.^...^...^.^.^.^.^...^.^...^...^.^....
.............................................................................................................................................
...^...^.....^.^.^...^.^.^...^.^.^.^.^.^.^.^.^.^.^.^.^.....^...^...^...^.^.^.^.^...^.^.^.^.^.^.^.^.......^.^.^.^.^.^...^.^...^.^.^...^...^...
.............................................................................................................................................
..^.^...^.^.^.^.^...^.^.^.^.^.^...^.^.^.^.^.^...^...^.....^.^.^.^.^...^.^...........^.^.^.^.^.^...^.^.^.^.^.^.^.^.^.^.^.........^.^.^...^.^..
.............................................................................................................................................
.^...^.^.^.^...^.....^.^.^.^.^.^.^.^.^...^.^.^...^.^.^...^.^...^.^.^.^...^...^.....^.....^...^.^...^.^.^...^.^.....^...^.^.^.^.^.^.^.^.^.^.^.
.............................................................................................................................................
";

pub fn run() {
    let now = Instant::now();
    part1();
    let elapsed = now.elapsed();
    println!("Part1 Elapsed: {}μs", elapsed.as_micros());

    let now = Instant::now();
    part2();
    let elapsed = now.elapsed();
    println!("Part2 Elapsed: {}μs", elapsed.as_micros());
}

fn part1() {
    let mut lines = INPUT2.lines().skip(1).collect_vec();
    let mut indices = HashSet::new();
    let mut splits = 0;

    for line in lines {
        for (i, char) in line.chars().enumerate() {
            match char {
                'S' => {
                    indices.insert(i);
                }
                '^' => {
                    if indices.remove(&i) {
                        splits += 1;
                        indices.insert(i + 1);
                        indices.insert(i - 1);
                    }
                }
                _ => {}
            }
        }
    }

    println!("{}", splits);
}

fn part2() {
    let lines = INPUT
        .lines()
        .filter(|l| !l.chars().all(|c| c == '.'))
        .collect_vec();
    let len = lines[0].len();
    lines.into_iter().rev().fold(vec![1; len], |acc, b| {
        b.chars()
            .enumerate()
            .map(|(i, c)| match c {
                '^' => acc.get(i - 1).unwrap_or(&0) + acc.get(i + 1).unwrap_or(&0),
                'S' => {
                    println!("{}", acc[i]);
                    acc[i]
                }
                _ => 0,
            })
            .collect()
    });
}
